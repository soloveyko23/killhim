(()=>{"use strict";let e=!1;setTimeout((()=>{if(e){let e=new Event("windowScroll");window.addEventListener("scroll",(function(t){document.dispatchEvent(e)}))}}),0);const t={"type-one":{logo:"./img/type-one/logo.png",die:"./img/type-one/die.jpg",fright:"./img/type-one/fright.jpg",default:"./img/type-one/default.jpg"},"type-two":{logo:"./img/type-two/logo.png",die:"./img/type-two/die.svg",fright:"./img/type-two/fright.jpg",default:"./img/type-two/default.png"},"type-three":{logo:"./img/type-three/logo.png",die:"./img/type-three/die.svg",fright:"./img/type-three/fright.svg",default:"./img/type-three/default.svg"}},o=10,s=700,i=500,n="./img/sounds/shot.mp3",r="./img/sounds/reload.mp3",c=1e3,a=300;let d=Object.keys(t)[Math.floor(Math.random()*Object.keys(t).length)],u={shotsRemaining:parseInt(localStorage.getItem("shotsRemaining"),10)||o,lastResetDate:localStorage.getItem("lastResetDate")||(new Date).toDateString(),isClicked:!1,soundMuted:!0,scareSoundPlaying:!1,scareAudio:null,shotAudio:new Audio(n),lastScareSoundTime:0,clickProcessing:!1,isClickedOnce:!1,temporaryShakeDisabled:!1};const l={soundButton:document.querySelector(".sound-button"),picture:document.querySelector(".picture"),pictureImage:document.querySelector(".picture__image img"),blood:document.querySelector(".picture__blood"),tokensInfo:document.querySelector(".tokens-info b"),cursor:document.querySelector(".picture__cursor"),headerLogo:document.querySelector(".header-app__logo img"),headerTradeImage:document.querySelector(".header-app__trade-image img")},g=(e,o=!1)=>{o?E(t[e].default):b(t[e].default),l.headerLogo.src=t[e].logo,l.headerTradeImage.src=t[e].logo},m=()=>{localStorage.setItem("shotsRemaining",u.shotsRemaining),localStorage.setItem("lastResetDate",u.lastResetDate)},p=()=>{const e=u.soundMuted?"charm_sound-mute.svg":"charm_sound-down.svg";l.soundButton.querySelector("img").src=`./img/${e}`},h=()=>{const e=Date.now();e-u.lastScareSoundTime<c||A()||"ontouchstart"in window||navigator.maxTouchPoints>0||(u.lastScareSoundTime=e,u.soundMuted||u.scareSoundPlaying||(u.scareAudio=new Audio("./img/sounds/ispugannoe-dyihanie.mp3"),u.scareSoundPlaying=!0,u.scareAudio.play().catch((e=>console.error("Sound playback failed:",e))),u.scareAudio.onended=()=>{u.scareSoundPlaying=!1}))},y=()=>{u.scareAudio&&(u.scareAudio.pause(),u.scareAudio.currentTime=0,u.scareSoundPlaying=!1)},f=()=>{l.tokensInfo.textContent=`${u.shotsRemaining} kill${1!==u.shotsRemaining?"s":""}/day`},S=()=>{setTimeout((()=>{l.blood.style.opacity="0",l.cursor.style.opacity="0"}),0)},k=()=>{l.pictureImage.classList.remove("shake")},w=()=>{u.soundMuted=!u.soundMuted,p()},I=()=>{u.temporaryShakeDisabled||u.isClicked||(l.pictureImage.src=t[d].fright,l.pictureImage.classList.add("shake"),h())},v=()=>{if(u.isClickedOnce)return;l.pictureImage.src=t[d].default,y(),S(),k();const e=l.picture.getBoundingClientRect();l.cursor.style.left=e.width-l.cursor.offsetWidth+"px",l.cursor.style.top=e.height-l.cursor.offsetHeight+"px",l.cursor.style.opacity="1"},b=e=>{u.clickProcessing=!0,R((()=>{T(),L(e),setTimeout((()=>{u.clickProcessing=!1}),i)}))},R=e=>{l.pictureImage.style.opacity="0",setTimeout(e,i)},L=e=>{l.pictureImage.src=e,setTimeout((()=>{l.pictureImage.style.opacity="1"}),50)},T=()=>{y(),S(),k()},E=e=>{l.pictureImage.style.transition="none",l.pictureImage.src=e,l.pictureImage.style.opacity="1",setTimeout((()=>{l.pictureImage.style.transition=`opacity ${i}ms ease`}),50)},D=e=>{u.clickProcessing||(u.clickProcessing=!0,u.shotsRemaining>0?(u.soundMuted||u.shotAudio.play().catch((e=>console.error("Shot sound playback failed:",e))),(e=>{const t=l.picture.getBoundingClientRect(),o=(e.clientX||e.touches[0].clientX)-t.left,s=(e.clientY||e.touches[0].clientY)-t.top;l.blood.style.left=o-l.blood.offsetWidth/2+"px",l.blood.style.top=s-l.blood.offsetHeight/2+"px",l.blood.style.opacity="1",A()||(l.cursor.style.left=o-l.cursor.offsetWidth/2+"px",l.cursor.style.top=s-l.cursor.offsetHeight/2+"px",l.cursor.style.opacity="1")})(e),l.pictureImage.src=t[d].fright,u.isClickedOnce=!0,u.shotsRemaining-=1,f(),m(),u.temporaryShakeDisabled=!0,k(),u.shotAudio.onended=()=>{const e=new Audio(r);e.play().then((()=>{e.onended=()=>{S();const e=(e=>{const o=Object.keys(t).filter((t=>t!==e));return o[Math.floor(Math.random()*o.length)]})(d);d=e,g(e),setTimeout((()=>{u.temporaryShakeDisabled=!1,u.clickProcessing=!1}),s)}})).catch((e=>{console.error("Error playing reload sound:",e),u.clickProcessing=!1}))}):(alert("Выстрелы закончились на сегодня!"),u.clickProcessing=!1))},P=e=>{const t=l.picture.getBoundingClientRect(),o=(e.clientX||e.touches?.[0]?.clientX||0)-t.left-l.cursor.offsetWidth/2,s=(e.clientY||e.touches?.[0]?.clientY||0)-t.top-l.cursor.offsetHeight/2;l.cursor.style.left=`${o}px`,l.cursor.style.top=`${s}px`,l.cursor.style.opacity="1"},A=()=>window.innerWidth<=a;l.headerLogo&&l.headerTradeImage&&(l.headerLogo.src=t[d].logo,l.headerTradeImage.src=t[d].logo),l.picture?(Object.values(t).forEach((e=>{Object.values(e).forEach((e=>{e&&((new Image).src=e)}))})),(()=>{const e=(new Date).toDateString();u.lastResetDate!==e&&(u.shotsRemaining=o,u.lastResetDate=e,m())})(),f(),p(),g(d,!0),A()?l.picture.addEventListener("touchstart",D):(l.picture.addEventListener("mousemove",I),l.picture.addEventListener("mouseleave",v),l.picture.addEventListener("mousemove",P),l.picture.addEventListener("click",D)),l.pictureImage.style.transition=`opacity ${i}ms ease`,l.soundButton.addEventListener("click",w)):console.warn("Element '.picture' not found. Skipping related logic."),window.FLS=!0,document.documentElement.classList.contains("loading")||window.addEventListener("load",(function(){setTimeout((function(){document.documentElement.classList.add("loaded")}),0)}))})();
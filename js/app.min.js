(()=>{"use strict";let e=!1;setTimeout((()=>{if(e){let e=new Event("windowScroll");window.addEventListener("scroll",(function(t){document.dispatchEvent(e)}))}}),0);const t={"type-one":{logo:"./img/type-one/logo.png",die:"./img/type-one/die.jpg",fright:"./img/type-one/fright.jpg",default:"./img/type-one/default.jpg"},"type-two":{logo:"./img/type-two/logo.png",die:"./img/type-two/die.svg",fright:"./img/type-two/fright.jpg",default:"./img/type-two/default.png"},"type-three":{logo:"./img/type-three/logo.png",die:"./img/type-three/die.svg",fright:"./img/type-three/fright.svg",default:"./img/type-three/default.svg"}},o=10,s=700,i=500,r="./img/sounds/shot.mp3",n="./img/sounds/reload.mp3",c=1e3,a=300;let l,u=0;const d=document.querySelector(".progress-bar-container"),g=document.querySelector(".progress-bar");let p=Object.keys(t)[Math.floor(Math.random()*Object.keys(t).length)],m={shotsRemaining:parseInt(localStorage.getItem("shotsRemaining"),10)||o,lastResetDate:localStorage.getItem("lastResetDate")||(new Date).toDateString(),isClicked:!1,soundMuted:!0,scareSoundPlaying:!1,scareAudio:null,shotAudio:new Audio(r),lastScareSoundTime:0,clickProcessing:!1,isClickedOnce:!1,temporaryShakeDisabled:!1};const y={soundButton:document.querySelector(".sound-button"),picture:document.querySelector(".picture"),pictureImage:document.querySelector(".picture__image img"),blood:document.querySelector(".picture__blood"),tokensInfo:document.querySelector(".tokens-info b"),cursor:document.querySelector(".picture__cursor"),headerLogo:document.querySelector(".header-app__logo img"),headerTradeImage:document.querySelector(".header-app__trade-image img")},h=(e,o=!1)=>{o?_(t[e].default):L(t[e].default),y.headerLogo.src=t[e].logo,y.headerTradeImage.src=t[e].logo},f=()=>{localStorage.setItem("shotsRemaining",m.shotsRemaining),localStorage.setItem("lastResetDate",m.lastResetDate)},S=()=>{const e=m.soundMuted?"charm_sound-mute.svg":"charm_sound-down.svg";y.soundButton.querySelector("img").src=`./img/${e}`},k=()=>{const e=Date.now();e-m.lastScareSoundTime<c||M()||"ontouchstart"in window||navigator.maxTouchPoints>0||(m.lastScareSoundTime=e,m.soundMuted||m.scareSoundPlaying||(m.scareAudio=new Audio("./img/sounds/ispugannoe-dyihanie.mp3"),m.scareSoundPlaying=!0,m.scareAudio.play().catch((e=>console.error("Sound playback failed:",e))),m.scareAudio.onended=()=>{m.scareSoundPlaying=!1}))},w=()=>{m.scareAudio&&(m.scareAudio.pause(),m.scareAudio.currentTime=0,m.scareSoundPlaying=!1)},I=()=>{y.tokensInfo.textContent=`${m.shotsRemaining} kill${1!==m.shotsRemaining?"s":""}/day`},v=()=>{setTimeout((()=>{y.blood.style.opacity="0",y.cursor.style.opacity="0"}),0)},b=()=>{y.pictureImage.classList.remove("shake")},T=()=>{m.soundMuted=!m.soundMuted,S()},R=()=>{m.temporaryShakeDisabled||m.isClicked||(y.pictureImage.src=t[p].fright,y.pictureImage.classList.add("shake"),k())},E=()=>{if(m.isClickedOnce)return;y.pictureImage.src=t[p].default,w(),v(),b();const e=y.picture.getBoundingClientRect();y.cursor.style.left=e.width-y.cursor.offsetWidth+"px",y.cursor.style.top=e.height-y.cursor.offsetHeight+"px",y.cursor.style.opacity="1"},L=e=>{m.clickProcessing=!0,D((()=>{P(),A(e),setTimeout((()=>{m.clickProcessing=!1}),i)}))},D=e=>{y.pictureImage.style.opacity="0",setTimeout(e,i)},A=e=>{y.pictureImage.src=e,setTimeout((()=>{y.pictureImage.style.opacity="1"}),50)},P=()=>{w(),v(),b()},_=e=>{y.pictureImage.style.transition="none",y.pictureImage.src=e,y.pictureImage.style.opacity="1",setTimeout((()=>{y.pictureImage.style.transition=`opacity ${i}ms ease`}),50)},q=e=>{m.clickProcessing||(m.clickProcessing=!0,m.shotsRemaining>0?(m.soundMuted||m.shotAudio.play().catch((e=>console.error("Shot sound playback failed:",e))),(e=>{const t=y.picture.getBoundingClientRect(),o=(e.clientX||e.touches[0].clientX)-t.left,s=(e.clientY||e.touches[0].clientY)-t.top;y.blood.style.left=o-y.blood.offsetWidth/2+"px",y.blood.style.top=s-y.blood.offsetHeight/2+"px",y.blood.style.opacity="1",M()||(y.cursor.style.left=o-y.cursor.offsetWidth/2+"px",y.cursor.style.top=s-y.cursor.offsetHeight/2+"px",y.cursor.style.opacity="1")})(e),y.pictureImage.src=t[p].fright,m.isClickedOnce=!0,d.style.display="block",y.picture.style.pointerEvents="none",u=0,l=setInterval((()=>{u+=1,g.style.width=`${u}%`,u>=100&&(clearInterval(l),setTimeout((()=>{d.style.opacity="0",g.style.width="0%"}),200),setTimeout((()=>{y.picture.style.pointerEvents="auto",d.style.display="none"}),500))}),30),m.shotsRemaining-=1,I(),f(),m.temporaryShakeDisabled=!0,b(),m.shotAudio.onended=()=>{new Audio(n).play().then((()=>{console.log("Reload sound played successfully")})).catch((e=>{console.error("Error playing reload sound:",e)}))},setTimeout((()=>{setTimeout((()=>{v();const e=(e=>{const o=Object.keys(t).filter((t=>t!==e));return o[Math.floor(Math.random()*o.length)]})(p);p=e,h(e),setTimeout((()=>{setTimeout((()=>{m.clickProcessing=!1,m.temporaryShakeDisabled=!1}),1e3)}),s)}),1e3)}),500)):(console.log("Выстрелы закончились на сегодня!"),alert("Выстрелы закончились на сегодня!")))},x=e=>{const t=y.picture.getBoundingClientRect(),o=(e.clientX||e.touches?.[0]?.clientX||0)-t.left-y.cursor.offsetWidth/2,s=(e.clientY||e.touches?.[0]?.clientY||0)-t.top-y.cursor.offsetHeight/2;y.cursor.style.left=`${o}px`,y.cursor.style.top=`${s}px`,y.cursor.style.opacity="1"},M=()=>window.innerWidth<=a;d.style.display="none",y.headerLogo&&y.headerTradeImage&&(y.headerLogo.src=t[p].logo,y.headerTradeImage.src=t[p].logo),y.picture?(Object.values(t).forEach((e=>{Object.values(e).forEach((e=>{e&&((new Image).src=e)}))})),(()=>{const e=(new Date).toDateString();m.lastResetDate!==e&&(m.shotsRemaining=o,m.lastResetDate=e,f())})(),I(),S(),h(p,!0),M()?y.picture.addEventListener("touchstart",q):(y.picture.addEventListener("mousemove",R),y.picture.addEventListener("mouseleave",E),y.picture.addEventListener("mousemove",x),y.picture.addEventListener("click",q)),y.pictureImage.style.transition=`opacity ${i}ms ease`,y.soundButton.addEventListener("click",T)):console.warn("Element '.picture' not found. Skipping related logic."),window.FLS=!0,document.documentElement.classList.contains("loading")||window.addEventListener("load",(function(){setTimeout((function(){document.documentElement.classList.add("loaded")}),0)}))})();